import unittest
#import argparse
import yaml
#from parser import wrapper
#import sys

from ..trigger_emulator.HLTBTagEmulator    import HLTBTagEmulator
from ..trigger_emulator.HLTHtEmulator      import HLTHtEmulator
from ..trigger_emulator.HLTJetEmulator     import HLTJetEmulator
from ..trigger_emulator.TrigEmulator       import TrigEmulator
from ..trigger_emulator.TrigEmulatorTool   import TrigEmulatorTool



class trigger_emulator_TestCase(unittest.TestCase):

    @classmethod
    def setUpClass(self):
        # Example objects that might represent thresholds, multiplicities, etc.

        self.HtEmulator_test   = HLTHtEmulator(high_bin_edge=[100, 200, 300], eff=[0.1, 0.2, 0.3], eff_err=[0.01, 0.02, 0.03])
        self.BTagEmulator_test = HLTBTagEmulator(high_bin_edge=[10, 20, 30], eff=[0.1, 0.2, 0.3], eff_err=[0.01, 0.02, 0.03])
        self.JetEmulator_test  = HLTJetEmulator(high_bin_edge=[100, 200, 300], eff=[0.1, 0.2, 0.3], eff_err=[0.01, 0.02, 0.03])

        ht_thresholds_test = [self.HtEmulator_test, self.HtEmulator_test]

        jet_thresholds_test = [self.JetEmulator_test, self.JetEmulator_test]

        jet_multiplicities_test = [2, 3]

        btag_op_points_test = [self.BTagEmulator_test, self.BTagEmulator_test]

        btag_multiplicities_test = [1, 2]

        # Instantiate the trigger emulator
        self.emulator_test = TrigEmulator(ht_thresholds_test, jet_thresholds_test, jet_multiplicities_test, btag_op_points_test, btag_multiplicities_test)

        self.debug = False

        self.sel_jet_pt_16_4b      = [[214.2285919189453, 175.33358764648438, 72.2542953491211, 54.064632415771484, 43.83559799194336], [313.07275390625, 164.7066192626953, 60.53831100463867, 49.591590881347656, 41.23313522338867], [64.79883575439453, 55.24069595336914, 49.24174118041992, 47.53494644165039, 46.778785705566406], [80.96756744384766, 58.90700912475586, 58.61721420288086, 41.028564453125], [178.8778839111328, 171.28480529785156, 104.02735900878906, 53.293739318847656], [67.74431610107422, 64.71231079101562, 47.229087829589844, 40.9347038269043], [105.04517364501953, 62.51596450805664, 57.60894012451172, 40.83856964111328], [282.6947326660156, 232.3583221435547, 58.91689682006836, 49.292232513427734], [154.27865600585938, 142.9830780029297, 124.93125915527344, 92.64350128173828, 64.56129455566406, 51.21128845214844], [91.31659698486328, 68.07000732421875, 55.7465705871582, 44.88181686401367], [213.5711212158203, 137.84873962402344, 51.063594818115234, 44.52283477783203, 40.00929641723633], [82.43749237060547, 72.76111602783203, 67.66842651367188, 61.59606170654297, 49.54731369018555], [198.0215301513672, 139.66342163085938, 82.0792007446289, 58.84580612182617], [283.4134826660156, 198.2870330810547, 78.14665985107422, 70.44496154785156, 50.30134582519531], [57.091102600097656, 48.24381637573242, 48.16244888305664, 46.01519775390625]]
        self.can_jet_pt_16_4b      = [[207.74314880371094, 166.943603515625, 64.38676452636719, 55.52223587036133], [305.8879699707031, 181.27378845214844, 73.0716323852539, 43.2464714050293], [73.4049301147461, 70.02189636230469, 57.65468978881836, 54.67564392089844], [86.73966979980469, 71.72594451904297, 61.610748291015625, 42.23057174682617], [181.6555633544922, 171.1917266845703, 92.59857177734375, 55.375526428222656], [67.08274841308594, 62.84804153442383, 50.41151809692383, 49.76924514770508], [103.76288604736328, 67.82737731933594, 55.02103805541992, 45.34516906738281], [281.038330078125, 225.32403564453125, 80.60797882080078, 47.31861877441406], [147.6494903564453, 145.0775604248047, 126.88330841064453, 112.09501647949219], [90.38024139404297, 69.13359832763672, 56.29096984863281, 53.73545837402344], [137.10833740234375, 52.551273345947266, 48.91424560546875, 43.35917663574219], [83.70370483398438, 70.90646362304688, 62.37804412841797, 43.16035461425781], [193.38040161132812, 138.77688598632812, 94.74376678466797, 75.10885620117188], [296.14495849609375, 197.6092987060547, 78.63143920898438, 74.67432403564453], [71.47538757324219, 52.43688201904297, 51.94684600830078, 42.941715240478516]]
        self.hT_16_4b              = [559.7166748046875, 629.1424560546875, 263.5950012207031, 239.52035522460938, 533.9176635742188, 246.36390686035156, 266.0086364746094, 623.2621459960938, 756.2518310546875, 260.0149841308594, 512.97021484375, 334.0104064941406, 500.8842468261719, 718.1207885742188, 199.51255798339844]
        self.hT_trigger_16_4b      = [559.7166748046875, 629.1424560546875, 263.5950012207031, 239.52035522460938, 507.4837951660156, 220.6204376220703, 266.0086364746094, 623.2621459960938, 630.6090698242188, 260.0149841308594, 552.0021362304688, 334.0104064941406, 478.60992431640625, 718.1207885742188, 199.51255798339844]
        self.trigWeightMC_16_4b    = [0.8999999761581421, 1.1111111640930176, 0.0, 0.0, 1.0, 1.7500001192092896, 1.7500001192092896, 0.8999999761581421, 1.0, 0.10000000149011612, 1.0, 0.875, 1.0, 1.0, 0.0]
        self.trigWeightData_16_4b  = [1.0, 0.8999999761581421, 0.0, 0.0, 1.0, 0.34279999136924744, 0.34279999136924744, 1.0, 1.0, 0.0, 0.7712999582290649, 0.800000011920929, 1.0, 1.0, 0.0]


        self.sel_jet_pt_16_3b      = [[100.3017807006836, 64.42876434326172, 46.52830505371094, 43.977840423583984], [130.9256134033203, 130.20037841796875, 73.0148696899414, 67.21369934082031], [165.8188018798828, 137.60595703125, 77.45037078857422, 56.03312683105469], [123.58543395996094, 117.79141998291016, 83.48268127441406, 52.48460006713867], [146.0230712890625, 103.16954803466797, 80.02053833007812, 65.66732788085938], [73.49595642089844, 63.25852966308594, 50.3542366027832, 48.7756462097168], [112.36759948730469, 89.22018432617188, 63.487361907958984, 45.44855499267578, 44.24697494506836], [180.44876098632812, 91.2061996459961, 90.24102020263672, 89.54366302490234, 78.39752197265625], [94.62602233886719, 82.2770004272461, 54.51179885864258, 48.856658935546875], [76.14363098144531, 75.37898254394531, 73.02185821533203, 58.31715774536133], [173.7105255126953, 136.85305786132812, 70.45635986328125, 70.52684020996094], [72.40763092041016, 63.50761413574219, 55.76750946044922, 48.45423126220703], [189.57302856445312, 178.63807678222656, 120.77115631103516, 44.05512237548828], [67.23365783691406, 60.30158996582031, 52.1351203918457, 41.28756332397461], [141.77810668945312, 98.3136978149414, 64.54975891113281, 59.13526916503906, 54.73424530029297]]
        self.can_jet_pt_16_3b      = [[113.81901550292969, 69.08474731445312, 52.996734619140625, 46.80093002319336], [141.3894805908203, 127.92097473144531, 72.46476745605469, 70.05577087402344], [166.30459594726562, 138.94976806640625, 88.03929138183594, 63.748626708984375], [129.74057006835938, 114.11043548583984, 83.31962585449219, 59.8652458190918], [157.00332641601562, 108.40863037109375, 81.19271087646484, 79.3907699584961], [70.01494598388672, 67.45928955078125, 60.336570739746094, 45.084129333496094], [110.3375244140625, 87.7389907836914, 69.50130462646484, 54.57415008544922], [175.16217041015625, 99.60466766357422, 90.24102020263672, 86.04586029052734], [104.32888793945312, 93.28475952148438, 58.664066314697266, 50.335716247558594], [89.92242431640625, 76.99845123291016, 76.14363098144531, 73.29509735107422], [167.51869201660156, 126.49552917480469, 81.4089126586914, 69.42428588867188], [82.73137664794922, 74.17491149902344, 58.76283645629883, 51.67189407348633], [188.0919952392578, 178.81253051757812, 121.71468353271484, 55.24099349975586], [76.55707550048828, 64.24710083007812, 54.833518981933594, 47.496826171875], [160.19264221191406, 124.04423522949219, 66.88212585449219, 59.11725997924805]]
        self.hT_16_3b              = [278.0433044433594, 401.35455322265625, 457.9127197265625, 408.98260498046875, 463.5638427734375, 292.8291931152344, 708.9324340820312, 588.1495361328125, 317.8617248535156, 282.86163330078125, 490.88409423828125, 240.13699340820312, 571.9340209960938, 257.91864013671875, 446.0842590332031]
        self.hT_trigger_16_3b      = [255.2366943359375, 401.35455322265625, 504.010498046875, 408.98260498046875, 463.5638427734375, 269.5746154785156, 393.39910888671875, 561.2354736328125, 317.8617248535156, 350.6413269042969, 523.8069458007812, 240.13699340820312, 571.9340209960938, 257.91864013671875, 418.51104736328125]
        self.trigWeightMC_16_3b    = [0.08569999784231186, 0.8999999761581421, 1.0, 1.0, 1.0, 0.3333333134651184, 1.4999998807907104, 1.0, 1.6666665077209473, 1.7500001192092896, 1.1111111640930176, 0.0, 1.0, 0.0, 1.0]
        self.trigWeightData_16_3b  = [0.0, 0.8569999933242798, 0.8569999933242798, 0.7712999582290649, 0.8569999933242798, 0.25710001587867737, 0.5142000317573547, 0.8569999933242798, 0.25710001587867737, 0.34279999136924744, 0.7712999582290649, 0.0, 0.8569999933242798, 0.0, 0.8569999933242798]



        self.sel_jet_pt_17_4b      = [[94.14671325683594, 68.3095474243164, 64.81517028808594, 62.5611686706543, 49.562095642089844], [175.96209716796875, 95.37551879882812, 77.43939208984375, 73.49510955810547, 68.43262481689453], [128.2674560546875, 79.69510650634766, 61.685760498046875, 60.18799591064453, 51.87247085571289], [192.0273895263672, 87.98374938964844, 78.9425048828125, 73.85894775390625, 57.82630157470703, 44.06169509887695], [146.6157684326172, 125.88066864013672, 108.48120880126953, 83.54424285888672, 43.43476486206055, 42.96830749511719], [87.06474304199219, 84.43431854248047, 54.27083969116211, 45.381954193115234], [128.74998474121094, 74.86860656738281, 70.81383514404297, 58.36476135253906], [139.6393585205078, 136.64593505859375, 54.482662200927734, 49.91389083862305], [205.29588317871094, 181.29681396484375, 142.15841674804688, 75.27525329589844, 46.8840217590332], [296.99310302734375, 240.38710021972656, 182.6641387939453, 102.75593566894531, 49.786102294921875], [98.76945495605469, 70.98324584960938, 62.399757385253906, 40.872886657714844], [129.11929321289062, 103.37531280517578, 100.68328094482422, 65.6379623413086], [185.93093872070312, 109.66726684570312, 77.6453628540039, 56.45912551879883, 43.405948638916016], [146.8939208984375, 135.6363067626953, 100.54847717285156, 76.04730224609375], [101.52064514160156, 61.07514190673828, 53.792572021484375, 40.79029083251953, 40.03313446044922]]
        self.can_jet_pt_17_4b      = [[89.18194580078125, 80.5172119140625, 73.2335433959961, 47.674476623535156], [86.0615005493164, 83.4137191772461, 78.30387115478516, 66.02678680419922], [126.57643127441406, 64.87847900390625, 63.36197280883789, 47.33869552612305], [88.65613555908203, 78.54725646972656, 60.81926345825195, 48.794883728027344], [153.63156127929688, 112.93063354492188, 84.84962463378906, 45.19225311279297], [96.75749969482422, 84.10449981689453, 55.96680450439453, 50.1240119934082], [125.79527282714844, 75.81908416748047, 71.71283721923828, 66.17332458496094], [139.434814453125, 134.5775604248047, 56.23845291137695, 48.50031280517578], [212.51332092285156, 177.04766845703125, 88.72776794433594, 52.19510269165039], [310.9146423339844, 252.3594970703125, 182.48574829101562, 113.79417419433594], [96.7921371459961, 70.4286880493164, 63.19194030761719, 41.43169403076172], [136.3065948486328, 103.73130798339844, 94.5419692993164, 82.04745483398438], [124.01825714111328, 71.69305419921875, 64.28842163085938, 44.508052825927734], [146.3201141357422, 136.1661376953125, 100.35209655761719, 74.11641693115234], [108.1631088256836, 65.42913055419922, 57.78498840332031, 46.640167236328125]]
        self.hT_17_4b              = [339.39471435546875, 616.1602783203125, 381.7087707519531, 534.7005615234375, 609.239990234375, 308.5756530761719, 332.79718017578125, 380.68182373046875, 650.910400390625, 872.5863037109375, 273.0253601074219, 398.81585693359375, 505.93988037109375, 508.5438537597656, 297.2117919921875]
        self.hT_trigger_17_4b      = [339.39471435546875, 490.7047424316406, 381.7087707519531, 534.7005615234375, 583.2319946289062, 308.5756530761719, 332.79718017578125, 380.68182373046875, 650.910400390625, 872.5863037109375, 308.27130126953125, 398.81585693359375, 505.93988037109375, 459.1259765625, 341.7541809082031]
        self.trigWeightMC_17_4b    = [1.0, 1.0, 1.600000023841858, 1.125, 1.25, 1.0, 1.3333332538604736, 1.75, 1.0, 1.0, 3.0, 1.4999998807907104, 1.2857142686843872, 1.25, 0.5]
        self.trigWeightData_17_4b  = [0.5, 0.8999999761581421, 0.5, 0.800000011920929, 0.800000011920929, 0.10000000149011612, 0.30000001192092896, 0.4000000059604645, 1.0, 0.8999999761581421, 0.10000000149011612, 0.6000000238418579, 0.699999988079071, 0.800000011920929, 0.20000000298023224]


        self.sel_jet_pt_17_3b      = [[236.8147430419922, 181.03001403808594, 89.54112243652344, 74.55448913574219, 61.65684127807617], [123.92142486572266, 102.43142700195312, 57.841766357421875, 44.85444641113281, 42.78567886352539], [168.2174530029297, 160.65728759765625, 72.12503051757812, 69.059326171875], [90.80712890625, 65.1836929321289, 56.50223159790039, 49.086544036865234], [185.8839111328125, 96.24378967285156, 67.19757843017578, 62.061607360839844, 51.21342086791992], [173.28683471679688, 121.4820556640625, 84.0767593383789, 69.57817840576172], [85.18518829345703, 81.65222930908203, 53.84463119506836, 40.399532318115234], [128.99072265625, 67.04338073730469, 56.516719818115234, 44.9577751159668], [279.2696533203125, 191.27496337890625, 110.20819091796875, 63.985595703125], [251.37060546875, 204.8258056640625, 120.617431640625, 70.62354278564453], [112.15107727050781, 109.8622817993164, 91.14763641357422, 41.80180358886719], [58.93479537963867, 46.559104919433594, 44.53849792480469, 42.68313217163086], [134.38189697265625, 94.80687713623047, 62.654701232910156, 40.8535270690918], [93.82278442382812, 79.57007598876953, 46.685890197753906, 45.343788146972656], [93.51392364501953, 76.55436706542969, 70.62260437011719, 41.42926788330078]]
        self.can_jet_pt_17_3b      = [[232.42071533203125, 185.9800567626953, 98.89746856689453, 73.68080139160156], [122.10617065429688, 98.1301040649414, 50.32984161376953, 41.573974609375], [166.41043090820312, 162.5399932861328, 73.84761810302734, 69.69503784179688], [93.5561752319336, 72.05853271484375, 61.41307067871094, 51.00398635864258], [98.87545776367188, 74.30422973632812, 72.31614685058594, 54.314231872558594], [212.54713439941406, 112.10990142822266, 86.70415496826172, 74.67424011230469], [88.74895477294922, 84.3948974609375, 58.62965393066406, 43.95027160644531], [122.62936401367188, 70.7098159790039, 61.815162658691406, 48.60181427001953], [282.8150634765625, 182.6825408935547, 113.6521987915039, 66.36006164550781], [258.2440185546875, 201.92544555664062, 122.73766326904297, 84.62410736083984], [126.16996765136719, 125.18425750732422, 85.18387603759766, 43.557151794433594], [54.15224075317383, 54.042747497558594, 52.32403564453125, 46.5179443359375], [131.1667022705078, 113.87935638427734, 63.69486618041992, 53.8995246887207], [96.93799591064453, 91.53666687011719, 54.33283996582031, 51.10828399658203], [95.52301025390625, 77.97480773925781, 72.5536880493164, 43.37126541137695]]
        self.hT_17_3b              = [643.5972290039062, 371.8347473144531, 499.1829528808594, 306.5500793457031, 482.8043518066406, 497.0313720703125, 294.3026123046875, 339.5673522949219, 733.5118408203125, 680.87548828125, 425.1230163574219, 283.7502746582031, 369.5325012207031, 298.9473876953125, 282.12017822265625]
        self.hT_trigger_17_3b      = [643.5972290039062, 416.3009338378906, 470.0591125488281, 261.57958984375, 462.60028076171875, 448.423828125, 294.3026123046875, 297.50860595703125, 684.20556640625, 680.87548828125, 425.1230163574219, 236.84158325195312, 369.5325012207031, 298.9473876953125, 282.12017822265625]
        self.trigWeightMC_17_3b    = [1.0, 1.2000000476837158, 1.5, 2.0, 1.0, 1.0, 0.0, 0.16740000247955322, 1.0, 1.0, 1.0, 0.0, 0.11160000413656235, 0.0, 0.055800002068281174]
        self.trigWeightData_17_3b  = [0.5580000281333923, 0.5, 0.33480000495910645, 0.055800002068281174, 0.5580000281333923, 0.5580000281333923, 0.0, 0.0, 0.5022000074386597, 0.5580000281333923, 0.11160000413656235, 0.0, 0.0, 0.0, 0.0]



        self.sel_jet_pt_18_4b      = [[79.71673583984375, 53.130916595458984, 53.010128021240234, 47.187801361083984, 41.76363754272461], [155.84779357910156, 102.6265640258789, 66.75184631347656, 51.70629119873047, 41.06223678588867, 40.62382507324219], [87.26068878173828, 83.62211608886719, 55.59723663330078, 50.23397445678711, 45.06193161010742], [119.6383056640625, 83.04755401611328, 49.441497802734375, 41.592315673828125], [108.62592315673828, 87.74525451660156, 49.38446807861328, 46.2125129699707], [170.81443786621094, 130.61888122558594, 70.07424926757812, 51.70863342285156, 44.6773681640625], [134.60488891601562, 112.33570098876953, 111.43029022216797, 67.18894958496094, 58.467071533203125], [81.62557983398438, 50.12408447265625, 47.935733795166016, 44.25437545776367], [99.98893737792969, 90.17474365234375, 64.49803924560547, 49.43076705932617], [47.93631362915039, 46.033424377441406, 44.2205924987793, 40.62003707885742], [107.49203491210938, 93.1122055053711, 75.81140899658203, 70.17074584960938, 59.41928482055664], [167.4306640625, 144.69676208496094, 63.81501770019531, 60.68540573120117], [304.99517822265625, 272.2544250488281, 193.7965087890625, 85.70270538330078, 63.62049865722656, 43.27769088745117], [63.987552642822266, 55.84632873535156, 45.96794891357422, 44.843048095703125, 41.689208984375], [62.84925842285156, 49.149253845214844, 41.589805603027344, 41.00441360473633]]
        self.can_jet_pt_18_4b      = [[83.06421661376953, 54.053993225097656, 50.66634750366211, 35.238067626953125], [159.95706176757812, 113.5506820678711, 47.91920852661133, 47.197513580322266], [86.96243286132812, 83.254638671875, 57.69057846069336, 51.85093688964844], [133.5415802001953, 85.56169128417969, 49.779476165771484, 41.592315673828125], [122.73456573486328, 91.94400024414062, 59.39030075073242, 44.368858337402344], [137.37942504882812, 73.49584197998047, 47.077030181884766, 41.432552337646484], [119.04759216308594, 115.67607879638672, 109.9222412109375, 56.428218841552734], [96.21296691894531, 58.20071792602539, 51.961585998535156, 44.232765197753906], [100.77010345458984, 88.41352081298828, 69.78889465332031, 52.134010314941406], [52.33671569824219, 51.068328857421875, 47.97761535644531, 46.649574279785156], [120.19373321533203, 98.20427703857422, 89.95201110839844, 72.36357879638672], [163.26124572753906, 150.06637573242188, 70.99718475341797, 68.6759262084961], [308.5693359375, 93.15147399902344, 70.01982879638672, 49.448143005371094], [56.119014739990234, 51.75883483886719, 45.63130569458008, 44.41691970825195], [85.0060806274414, 49.956504821777344, 48.62128448486328, 43.96762466430664]]
        self.hT_18_4b              = [375.9543762207031, 481.3679504394531, 321.77593994140625, 330.0383605957031, 350.5711364746094, 467.8935546875, 484.0268859863281, 249.7370147705078, 364.2627258300781, 178.8103790283203, 526.8958129882812, 466.5706787109375, 1062.5711669921875, 252.33407592773438, 222.29067993164062]
        self.hT_trigger_18_4b      = [307.0826721191406, 501.87286376953125, 321.77593994140625, 330.0383605957031, 330.0091552734375, 467.8935546875, 484.0268859863281, 266.506591796875, 342.89080810546875, 178.8103790283203, 436.8294677734375, 436.6278381347656, 963.6470336914062, 252.33407592773438, 194.5927276611328]
        self.trigWeightMC_18_4b    = [0.0, 1.0, 0.4000000059604645, 0.10000000149011612, 1.0, 1.6666666269302368, 1.1111111640930176, 0.0, 0.20000000298023224, 0.0, 1.0, 0.8999999761581421, 1.0, 0.0, 0.0]
        self.trigWeightData_18_4b  = [0.0, 0.699999988079071, 0.0, 0.0, 0.10000000149011612, 0.6000000238418579, 0.8999999761581421, 0.0, 0.0, 0.0, 1.0, 1.0, 0.8999999761581421, 0.0, 0.0]


        self.sel_jet_pt_18_3b      = [[219.4598388671875, 166.61691284179688, 152.77236938476562, 56.78550338745117], [397.4637145996094, 213.5983123779297, 145.4928741455078, 80.07303619384766, 48.92510223388672], [105.13151550292969, 85.24738311767578, 65.39019775390625, 54.659053802490234], [120.11238098144531, 69.01318359375, 60.676212310791016, 41.23326110839844], [207.04969787597656, 135.87620544433594, 77.42484283447266, 75.0081787109375], [65.5027084350586, 64.69483947753906, 60.247215270996094, 48.25959014892578], [152.0613555908203, 139.84136962890625, 114.56790161132812, 104.23050689697266], [132.14056396484375, 88.80165100097656, 65.00230407714844, 56.25274658203125], [172.62925720214844, 171.4425048828125, 103.31224822998047, 59.79618453979492, 55.8125, 53.4638557434082], [139.56903076171875, 79.623779296875, 58.02684783935547, 40.947113037109375], [66.93614196777344, 65.5030288696289, 56.12521743774414, 54.15709686279297, 53.27550506591797, 52.12401580810547], [388.1932678222656, 319.0317077636719, 48.22266387939453, 47.278011322021484], [121.61371612548828, 100.6903076171875, 76.31804656982422, 58.431983947753906, 48.28045654296875], [81.30570983886719, 73.81096649169922, 51.56700897216797, 40.6407356262207], [526.3759765625, 491.83868408203125, 182.60989379882812, 125.90801239013672]]
        self.can_jet_pt_18_3b      = [[227.38954162597656, 172.31182861328125, 139.04672241210938, 67.82096862792969], [240.9238739013672, 146.48745727539062, 80.30762481689453, 53.559608459472656], [105.43952178955078, 96.81904602050781, 70.8180923461914, 58.34213638305664], [124.80426788330078, 78.51597595214844, 65.71281433105469, 43.528472900390625], [207.45408630371094, 142.6434783935547, 79.76876068115234, 76.91268157958984], [70.36686706542969, 66.21112823486328, 64.09542083740234, 54.244911193847656], [154.14031982421875, 149.67396545410156, 114.81642150878906, 114.6797866821289], [136.52804565429688, 97.64712524414062, 67.16058349609375, 62.954734802246094], [106.54075622558594, 66.04441833496094, 58.945987701416016, 58.81024169921875], [132.6859893798828, 79.93480682373047, 61.7101936340332, 43.546295166015625], [67.35809326171875, 59.403053283691406, 57.75346755981445, 57.33359909057617], [391.22601318359375, 314.2026062011719, 51.340965270996094, 48.92905044555664], [125.41414642333984, 101.77194213867188, 80.9388656616211, 63.16817092895508], [87.89591979980469, 82.02820587158203, 49.25052261352539, 38.81507873535156], [535.1146240234375, 481.75213623046875, 179.310791015625, 142.6301727294922]]
        self.hT_18_3b              = [595.6346435546875, 971.8514404296875, 348.4104919433594, 347.7823791503906, 550.2018432617188, 266.1368103027344, 542.3912353515625, 342.197265625, 695.2314453125, 485.90765380859375, 348.12103271484375, 869.7891845703125, 441.555908203125, 247.3244171142578, 1326.7325439453125]
        self.hT_trigger_18_3b      = [595.6346435546875, 923.7105712890625, 348.4104919433594, 326.0013122558594, 495.3589172363281, 238.704345703125, 589.0716552734375, 342.197265625, 616.45654296875, 318.1667785644531, 348.12103271484375, 802.7256469726562, 441.555908203125, 247.3244171142578, 1326.7325439453125]
        self.trigWeightMC_18_3b    = [1.0, 1.0, 2.5, 0.06000000238418579, 1.0, 0.0, 1.0, 0.18000000715255737, 1.4285715818405151, 0.06000000238418579, 0.0, 0.7777777910232544, 1.7999998331069946, 0.0, 1.0]
        self.trigWeightData_18_3b  = [0.6000000238418579, 0.6000000238418579, 0.12000000476837158, 0.0, 0.41999998688697815, 0.0, 0.6000000238418579, 0.0, 0.41999998688697815, 0.0, 0.12000000476837158, 0.5399999618530273, 0.30000001192092896, 0.0, 0.6000000238418579]

        self.event_num_cpp = [725363, 725378, 725412, 725416, 725441]
        self.sel_jet_pt_cpp_18 = [[166.75,  136.875,  68.9375,  52.5,  49.0625], [65.6875,  63.9375,  50.6875,  40.625], [145.25,  73.25,  42.375,  40.1562], [91.875,  70.375,  68.25,  49], [172.875,  69.375,  63.9688,  60.875,  42.3125]]
        self.can_jet_pt_cpp_18 = [[136.875, 68.9375,  52.5,  49.0625], [50.6875,  63.9375,  65.6875,  40.625], [145.25,  73.25,  42.375,  40.1562], [91.875,  70.375,  68.25,  49], [69.375,  60.875,  63.9688,  42.3125]]
        self.hT_trigger_cpp_18 = [474.125, 220.938, 301.031, 279.5, 445.844]
        self.trigWeightData_cpp_18 =  [0.9, 0, 0, 0, 0.5]




    def test_HLTBTagEmulator(self):
        emulator = self.BTagEmulator_test
        result = emulator.passJetThreshold(pt=25, bTagRand=0.15, smearFactor=1.0)
        print(result)

    def test_HLTHtEmulator(self):
        emulator = self.HtEmulator_test
        result = emulator.passHt(ht=150, seedOffset=1.5, smearFactor=1.0)
        print(result)


    def test_HLTJetEmulator(self):
        emulator = self.JetEmulator_test
        result = emulator.passJet(pt=150, seedOffset=1.5, smearFactor=1.0)
        print(result)

    def test_passTrig(self):

        # Example data
        offline_jet_pts = [100, 150, 200]
        offline_btagged_jet_pts = [120, 180]
        ht = 500
        seedOffset = 1.2

        # Check if the trigger passes
        result = self.emulator_test.passTrig(offline_jet_pts, offline_btagged_jet_pts, ht, seedOffset)
        print(result)  # Output: True or False based on the checks


    def test_calcWeight(self):

        # Example data
        offline_jet_pts = [100, 150, 200]
        offline_btagged_jet_pts = [120, 180]
        ht = 500

        # Calculate the weight
        weight = self.emulator_test.calcWeight(offline_jet_pts, offline_btagged_jet_pts, ht)
        print(weight)  # Output: The calculated weight as a float


    def test_yaml(self):
        input_file_name = "analysis/trigger_emulator/data/haddOutput_All_MC2016_11Nov_fittedTurnOns.yaml"
        with open(input_file_name, 'r') as infile:
            data = yaml.safe_load(infile)

        #print(data.keys())

    def _test_trig_weights(self, emulator_data, emulator_mc, sel_jets, can_jets, ht, trigWeights_data, trigWeights_mc):

        for iE in range(len(sel_jets)):
            _sel_jet_pt = sel_jets[iE]
            _can_jet_pt = can_jets[iE]
            _hT         = ht[iE]
            print(f"Data Emulation \t {emulator_data.GetWeightOR(_sel_jet_pt, _can_jet_pt, _hT)} vs {trigWeights_data[iE]}")
            print(f"MC Emulation \t   {emulator_mc.GetWeightOR(_sel_jet_pt, _can_jet_pt, _hT)} vs {trigWeights_mc[iE]}")

    def test_trig_weight_17(self):
        emulator_test_tool_data_2017 = TrigEmulatorTool("Test", year="2017")
        emulator_test_tool_mc_2017   = TrigEmulatorTool("Test", year="2017", useMCTurnOns=True)
        print("test_trig_weight_17\n")

        self._test_trig_weights(emulator_test_tool_data_2017, emulator_test_tool_mc_2017,
                                self.sel_jet_pt_17_4b, self.can_jet_pt_17_4b, self.hT_17_4b,
                                self.trigWeightData_17_4b, self.trigWeightMC_17_4b)


    def test_trig_weight_16(self):
        emulator_test_tool_data_2016 = TrigEmulatorTool("Test", year="2016")
        emulator_test_tool_mc_2016   = TrigEmulatorTool("Test", year="2016", useMCTurnOns=True)
        print("test_trig_weight_16\n")

        self._test_trig_weights(emulator_test_tool_data_2016, emulator_test_tool_mc_2016,
                                self.sel_jet_pt_16_4b, self.can_jet_pt_16_4b, self.hT_16_4b,
                                self.trigWeightData_16_4b, self.trigWeightMC_16_4b)



    def test_trig_weight_18(self):
        emulator_test_tool_data_2018 = TrigEmulatorTool("Test", year="2018")
        emulator_test_tool_mc_2018   = TrigEmulatorTool("Test", year="2018", useMCTurnOns=True)

        print("test_trig_weight_18\n")

        self._test_trig_weights(emulator_test_tool_data_2018, emulator_test_tool_mc_2018,
                                self.sel_jet_pt_18_4b, self.can_jet_pt_18_4b, self.hT_18_4b,
                                self.trigWeightData_18_4b, self.trigWeightMC_18_4b)


    def test_trig_weight_cpp_18(self):
        emulator_test_tool_data_2018 = TrigEmulatorTool("Test", year="2018", nToys=10)

        print("test_trig_weight_cpp_18\n")

        for iE in range(len(self.sel_jet_pt_cpp_18)):
            _sel_jet_pt = self.sel_jet_pt_cpp_18[iE]
            _can_jet_pt = self.can_jet_pt_cpp_18[iE]
            _hT         = self.hT_trigger_cpp_18[iE]
            print(f"Data Emulation \t {emulator_test_tool_data_2018.GetWeightOR(_sel_jet_pt, _can_jet_pt, _hT, debug=False)} vs {self.trigWeightData_cpp_18[iE]}")




    def test_trig_weight_16_3b(self):
        emulator_test_tool_data_2016_3b = TrigEmulatorTool("Test", year="2016", is3b=True)
        emulator_test_tool_mc_2016_3b   = TrigEmulatorTool("Test", year="2016", useMCTurnOns=True, is3b=True)

        print("test_trig_weight_16_3b\n")

        self._test_trig_weights(emulator_test_tool_data_2016_3b, emulator_test_tool_mc_2016_3b,
                                self.sel_jet_pt_16_3b, self.can_jet_pt_16_3b, self.hT_16_3b,
                                self.trigWeightData_16_3b, self.trigWeightMC_16_3b)


    def test_trig_weight_17_3b(self):
        emulator_test_tool_data_2017_3b = TrigEmulatorTool("Test", year="2017", is3b=True)
        emulator_test_tool_mc_2017_3b   = TrigEmulatorTool("Test", year="2017", useMCTurnOns=True, is3b=True)

        print("test_trig_weight_17_3b\n")

        self._test_trig_weights(emulator_test_tool_data_2017_3b, emulator_test_tool_mc_2017_3b,
                                self.sel_jet_pt_17_3b, self.can_jet_pt_17_3b, self.hT_17_3b,
                                self.trigWeightData_17_3b, self.trigWeightMC_17_3b)



    def test_trig_weight_18_3b(self):
        emulator_test_tool_data_2018_3b = TrigEmulatorTool("Test", year="2018", is3b=True)
        emulator_test_tool_mc_2018_3b   = TrigEmulatorTool("Test", year="2018", useMCTurnOns=True, is3b=True)

        print("test_trig_weight_18_3b\n")

        self._test_trig_weights(emulator_test_tool_data_2018_3b, emulator_test_tool_mc_2018_3b,
                                self.sel_jet_pt_18_3b, self.can_jet_pt_18_3b, self.hT_18_3b,
                                self.trigWeightData_18_3b, self.trigWeightMC_18_3b)


if __name__ == '__main__':
    # wrapper.parse_args()
    # unittest.main(argv=sys.argv)
    unittest.main()
